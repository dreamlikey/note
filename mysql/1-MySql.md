#### Mysql页结构

#### mysql行结构

#### 表结构

##### 字段类型选取

- **保小不保大**

- **能用占用空间小的字段就不用打字段**。

- **更小的字段类型占用的内存少，占用的磁盘空间和I/O也更少，而且还会占用更少的带宽**



##### 字符类型

###### 与字符编码的关系

- **latin 1byte、gbk 2byte、utf8 3byte**

- mysql字符类型保存长度以字节为单位，定义字符类型时的长度是以字符为单位

  例如：char(10)表示最多保存10个字符长度数据，如果采用utf8字符编码则占用30个字节。

###### char(M)

保存固定长度字符串，最大长度***255个字符***，比指定长度大的值将被截短，比指定长度小的值在右侧以空格填补。

###### varchar(M)

保存变长字符串，最大长度**65535个字节，1-2个字节用于存储字符串长度**，>255个字符2个字节保存长度否则1个字节。



###### text



##### 数值类型



##### 时间类型

| 数据类型  | 值                    | 存储字节 |
| :-------- | :-------------------- | -------- |
| DateTime  | ‘0000-00-00 00:00:00’ | 8字节    |
| TimeStamp | ‘0000-00-00 00:00:00’ | 4字节    |
|           |                       |          |
|           |                       |          |



数据库引擎
	innodb
	myisam
	
索引
	索引类型
		B+Tree 多路平衡查找树
		聚簇索引
		非聚簇索引

事务隔离级别
	第一类丢失更新、脏读、不可重复读、幻读
	
性能优化
	1、性能优化法则
	2、索引优化
		频繁更新的字段不适合做为索引
		数据重复率高的字段不适合做为索引
		
​		
	3、表结构设计
		a、适当冗余
		
		b、字段类型选取
			数字类型与字符类型区别


​			
​			数值类型
​				手机号	
​				ip地址  
​				年龄 	tinyint
​				状态 	tinyint
​				
​			字符类型
​				char
​				varchar
​			时间类型
​				datetime
​				timestamp

数据类型
	
	数字类型
		数字类型字段所占磁盘空间是固定的，tinyint 1byte、smallint 2byte、int 4byte、bigint 8byte，
		声明一个字段int(5)，括号中的数字不是字段长度，而是字段的显示宽度（int类型占4个字节），存入数字小于宽度左侧用0补满，不限制超过指定宽度的显示。
			例如：存入1显示为00001，123456显示为123456
		
		tinyint		1字节
		smallint 	2字节
		int			4字节
		bigint		8字节
	字符串类型
		MySql规定一行数据的字符类型数据总长度不能超过65535字节
		字符串类型字段所占存储空间与编码有关，不同的编码下每个字符所占空间如下
			latin 1byte、gbk 2byte、utf8 3byte
		char 	定长字符型
			
		varchar	变长字符型 1-2个字段存储字符长度

​		

### JOIN优化

#### 驱动表和被驱动表

优先选择数据量少的表作为驱动表

- 多表关联查询的时候，第一个被处理的表就是驱动表，使用驱动表关联其他表。

- 驱动表会直接影响到多表关联的顺序，决定了关联查询的性能。

  

如何确定驱动表：

1）连接查询存在where条件：

带where条件的表就是驱动表。

#### JOIN原理

https://www.modb.pro/db/458431

##### SNL算法【简单嵌套循环匹配】



##### INL算法【索引嵌套循环匹配】

驱动表字段匹配关联表关联字段的索引

匹配到索引再去关联数据。

【**被驱动表关联字段需要建立索引**】

#### BNL 【块嵌套循环匹配】

如果关联查询没有命中索引的情况下，使用到join_buffer嵌套循环算法。小表驱动大表。



扫描驱动表批量顺序读取数据行放入join_buffer中【一次读取多少数据取决于join_buffer大小，如果一次装不下分多次读取驱动表数据然后继续比较】，把关联表中每一行取出来在内存中与jong_buffer中的数据对比，满足条件的作为结果集的一部分返回。



时间复杂度与简单循环嵌套匹配一样，但是BNL的循环判断是在内存中进行并，性能更好。



### 问题

1、varchar(100)占多少磁盘空间

varchar是不定长字符串，varchar(100)表示最大可存100个字符，所占磁盘空间与实际存储字符长度 和 字符编码有关，latin 一个字符占用1一个字节，gbk占用2个字节，utf8占用3个字节，同时还需要1-2个额外字节存储字符串长度，以存储10个字符举例latin编码下占用11字节、gbk占用21字节、utf8编码下占用31字节。

隐藏字段 rowid、长度，

2、varchar（50）和（200）有什么不一样

​		存储最大字符个数不同

​        varchar（50）和（200）存储hello所占空间一样，但后者在排序时会消耗更多的内存，因为order by col采用fixed_length计算col长度

​		

3、字符编码所对应的字符排序


表字符集不同时，可能导致join的SQL使用不到索引，引起严重的性能问题；		

innodb下索引的最大长度为767字节

4、join 和 exists的区别以及实现原理？

