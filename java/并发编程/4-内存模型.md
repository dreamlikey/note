### 现代计算机的内存模型

CPU处理器只负责计算不能存储数据，CPU最终需要将计算结果存储到存储设备RAM/IO设备，由于现代计算机CPU的计算速度要比内存的存取速度快很多（几个数量级），将CPU的计算结果存储到RAM内存或从内存中读取数据都会极大拖慢CPU运行效率，所以现代计算机不得不加入一层**存取速度接近CPU运算速度的高速缓存（Cache）来作为CPU与内存之间的缓冲**，运算需要的数据存储在高速缓存中，让运算快速进行，运算后将缓存中的数据同步回内存中，这样处理器就无须等待缓慢的内存读写。



#### 缓存一致性问题

在多处理器（多核）系统中，每个CPU都有自己的缓存（Cache）同时多个CPU共享同一个主内存（Main Memery）,A 处理器读取主内存数据将计算结果存放在Cache中还没存放到主内存，这时B 处理器也从主内存读取数据进行计算，由于主内存中的数据不是最新的，当A、B处理器将计算数据同步回主内存时最终将导致其中一个计算结果丢失（被覆盖）。



#### 一致性协议

为了解决一致性的问题，需要各个处理器访问缓存时都遵循一些协议，在读写时要根据协议来进行操作，这类协议有MSI、MESI（Illinois Protocol）、MOSI、Synapse、Firefly及Dragon Protocol等。



### JMM

JMM  java内存模型（java memery model）是一种规范，**定义了Java虚拟机在计算机内存中的工作方式**，

JVM是整个计算机的虚拟模型，所以JMM是从属于JVM的，JMM定义了线程和主内存之间的抽象概念，线程之间的共享变量存在主内存中（Main Memery），每个线程都有私有的本地内存（Local Memery），本地内存中存储了该线程以读/写共享变量的副本。**本地内存是JMM的一个抽象概念，并不真实存在。它涵盖了缓存、写缓冲区、寄存器以及其他的硬件和编译器优化。**

![image/JMM.jpg](image\JMM.jpg)

https://zhuanlan.zhihu.com/p/29881777