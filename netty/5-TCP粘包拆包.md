#### TCP粘包/拆包

##### 概念

TCP是一个流协议，没有边界划分，会根据TCP缓冲区的实际情况进行包的划分，所以在业务上认为，TCP会将一个完整的包拆分陈多个包发送，也可能将多个小包合并成一个大包发送，这就是所谓的TCP粘包/拆包问题



##### 问题原因

1、应用程序write写入的字节数大于套接口发送缓冲区大小

2、进行MSS大小的TCP分段

3、以太网帧的payload大于MTU进行IP分片



##### 粘包问题解决策略

由于TCP无法理解上层业务逻辑，所以在底层无法保证数据包不被拆分和重组，这个问题只能通过上层应用协议设计来解决，解决策略如下：

1、消息定长，例如每个报文的大小固定200个字节，如果不够空格补齐

2、特殊字符分割，例如在包尾使用回车符分割，如FTP协议

3、消息头、消息体，消息头包含数据长度，通过数据长度重消息体中取出数据

4、更复杂的应用层协议



##### netty粘包解决方法

###### LineBasedFrameDecoder

**手动定义分隔符作为码流结束标志的消息解码**

###### DelimiterBasedFrameDecoder

**自动完成以分隔符作为码流结束标志的消息解码**，与LineBasedFrameDecoder需要手动在消息的末尾加上自定义结束符

###### FixedLengthFrameDecoder

固定长度解码器，按照指定的长度对消息进行解码。

缺点：报文长度固定，实际消息长度不够则空格补齐**浪费空间**，单个消息超出长度则还是会**出现粘包**